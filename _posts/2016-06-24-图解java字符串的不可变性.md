---
date: 2016/6/24 星期五  20:52:41+0800
layout: post
title: 图解java字符串的不可变性
thread: 164
categories: java
tags: string
---

下面用一组图表来说明Java中String类型的不可变性。

#### 1.声明一个字符串

```java
String s = "abcd";
```

 s 存储的是字符串对象的引用。箭头可以理解为“存储……的引用”。

![enter image description here](/assets/String-Immutability-1.jpeg)
 
#### 2.将一个字符串变量分配给另一个字符串变量

```java
String s2 = s;
```

s2与s存储的是相同的引用地址，因为是相同的字符串对象。

![enter image description here](/assets/String-Immutability-2.jpeg)

#### 3.连接字符串

```java
s = s.concat("ef");
```
s现在存储的是新创建字符串对象的引用。

![enter image description here](/assets/string-immutability-650x279.jpeg)

#### 总结

一旦字符串在[堆内存](http://www.programcreek.com/2013/04/jvm-run-time-data-areas/)中被创建，它的值就不能被修改。我们应该注意到所有的String方法都不能改变字符串本身，而是会返回一个新的字符串。

如果需要字符串能被修改，我们应该使用StringBuffer或者StringBuilder。否则垃圾回收器会浪费大量时间来回收垃圾。因为每次都会创建一个新的字符串。[这里](http://www.programcreek.com/2011/11/java-read-file-into-a-string/)是一个StringBuilder使用的例子。


原文地址:[Diagram to show Java String’s Immutability](http://www.programcreek.com/2009/02/diagram-to-show-java-strings-immutability/)