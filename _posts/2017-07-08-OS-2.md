---
date: 2017/7/8 星期六  18:59:19+0800
layout: post
title: (OS-王道)第2章 进程管理
thread: 164
categories: 操作系统
tags:  进程
---

# 2.1 进程与线程
## 1. 为什么要引入进程？
在多道程序同时运行的背景下，进程之间需要共享系统资源，这样就会导致各程序在执行过程中出现相互制约的关系，程序的执行就会表现出间断性的特征。这些特征都是在程序的执行过程中发生的，是动态的过程，而传统的程序本身是一组指令的集合，是一个静态的概念，无法描述程序在内存中的执行情况，即我们无法从程序的字面上看出它何时执行、何时停顿，也法看出它与其他程序的关系，因此，程序这个静态概念已不能如实反映程序并发执行过程的特征。为了深刻描述程序动态执行过程的性质乃至更好地支持和管理多道程序的并发执行，人们引入进程概念。

## 2. 什么是进程及进程由什么组成？
进程是一个具有独立功能的程序关于某个数据集合的一次运行活动。它可以申请和拥有系统资源，是一个动态的概念，是一活动的实体。它不只是程序的代码本身，还包括当前的活动，通过程序计数器的值和处理寄存器的内容来表示。
一个进程实体由程序段、相关数据段和PCB三部分构成，其中PCB是标志一个进程存在的唯一标识，程序段是进程运行的程序的代码，数据段则存储程序运行过程中相关的一些数据。

## 3. 进程是如何解决问题的？
进程把能够识别程序运行状态的一些变量存入在PCB中，通过这些变量系统能够更好地了解进程的状况，并在适当的时候进行进程的切换，以避免一些资源的浪费。甚至划分为更小的调度单位——线程来提高系统的并发度。

本节的内容主要是介绍什么是进程，围绕着这个问题进行了一些阐述和讨论，这下一节讨论的内容做铺垫，但之前未学过相关课程的读者可能会比较费解，到现在为止对进程这个概念还没形成比较清晰的认识，接下来，我们再用一个我们比较熟悉的概念去类比进程，大家就能彻底理解本节内容到底在讲什么，到底解决什么问题。

我们用"人的生命历程"去类比进程。首先，人的生命历程一定是一个动态的、过程性的概念，要研究人的生命历程，先要介绍经历这个历程的主体是什么，当然是人，也就相当于经历进程的主体是进程映像，人有属于自己的身份，就相当于进程映像里有PCB；人生历程会经历好几种状态：出生的时候、弥留的时候、充满斗志的时候、发愤图强的时候，可能还会有失落的时候，相当于进程会有创建、撤销、就绪、运行、阻塞，这几种状态会发生改变，人会充满斗志而转向发奋图强，发愤图强获得进步之后又会充满斗志预备下一次发愤图强，或者发愤图强后遇到阻碍会进入失落状态，然后在别人的开导之下又会重新充满斗志，类比进程，会由就绪状态转向运行态，运行态转向就绪态，或者运行态转向阻塞态，然后在别的进程帮助下可能会返回就绪态。

如果我们可以用“人生历程”这个过程的概念去类比进程，那么对进程的理解就会更深一层。前面生活化的例子可以帮我们理解进程的实质，但它毕竟有不严谨的地方。一个较好的方式是，在类比了进程和“人生历程”后，再看一遍前面较为严谨的书面阐述和讨论，这样对知识的掌握会更加准确而全面。

这里再给出一些学习计算机科学知识的建议，学习科学知识的时候，很多同学会陷入一个误区，只注重对定理、公式的应用，而忽视对基础概念的理解。这是从小到大为了应付考试而培养出的一个毛病，因为熟练应用公式定理对考试有立竿见影的效果。公式定理的应用固然重要，但基础概念的理解能让我们透彻地理解一门学科，更利于我们产生兴趣，培养创造性思维。

本节的知识架构图如下：

![进程](http://img.hkjdy.cn/process.png)
[原图](http://img.hkjdy.cn/process.png)

# 2.2 处理机调度
## 1. 为什么要进行处理机调度
若没有处理机调度，就意味着要等到当前运行的进程执行完毕后，下一个进程才能执行，而实现情况中，进程时常需要等待一些外部设备的输入，而外部设备的速度与处理机相比是非常缓慢的，如果让处理机总是等待外部设备，那么对处理机的资源是极大的浪费。而引进处理机调度后，可以在运行进程等待外部设备时，把处理机调度给其他进程，从而提高处理机的利用率。用一句简单的话说，就是为了合理地处理计算机软硬件资源。

## 2. 调度的算法有哪几种？结合第1章学习的分时操作系统和实现操作系统，思考有没有哪种调度算法比较适合这两种操作系统。
本节介绍的调度算法有先来先服务调度算法，短作业优先调度算法、优先级调度算法、高响应比优先调度算法、时间片轮转调度算法、多级反馈队列调度算法六种。

先来先服务算法和短作业优先算法无法保证及时的接收和处理问题，就无法保证在规定的时间间隔内，响应每个用户的需求。也同样无法达到实时操作系统的及时性需求。优先级调度算法按照任务的优先级进行调度，对于更紧急的任务给予更高的优先级，适合实时操作系统。

高响应比优先调度算法、时间片轮转调度算法、多级反馈队列调度算法都能保证每个任务在一定时间内分配到时间片，并轮流占用CPU，适合分时操作系统。

本节主要介绍了处理机调度的概念。操作系统主要管理处理机、内存、文件、设备几种资源，凡是当对资源的请求大于资源本身的数量的时候，就会涉及到调度。比如在单处理机系统中，处理机只有一个，而请求服务的进程却有多个，所以就有处理机调度的概念出现。而出现了调度的概念之后，又有了一个问题，那就是如何调度、应该满足谁、应该让谁等待，这就是调度算法所回答的问题。而应该满足谁、应该让谁等待，要遵循一定的准则，这就是调度的准则。调度这个概念贯穿于操作系统的始终，读者在接下来的学习中接触到几种对资源的调度问题和相应的调度算法。将他们与处理机调度的内容相对比，将会发现他们有异曲同工之妙。

本节的知识架构图如下：

![调度](http://img.hkjdy.cn/diaodu.png)
[原图](http://img.hkjdy.cn/diaodu.png)

# 2.3 进程同步
## 1. 为什么要引入进程同步的概念？
在多道程序共同执行的条件下，进程与进程是并发执行的，不同进程之间存在着不同的相互制约关系。为了协调进程之间的相互制约关系，引入了进程同步的概念。

## 2. 不同的进程之间会存在什么关系？
进程之间存在同步与互斥的制约关系。

同步是指为完成某种任务而建立的两个或多个进程，这些进程因为需要在某些位置上协调它们的工作次序而等待、传递信息所产生的制约关系。

互斥是指当一个进程进入临界区使用临界资源时，另一个进程必须等待，当占用临界资源的进程退出临界区后，另一进程才允许去访问此临界资源。

## 3. 当单纯用本节介绍的方法解决这些问题时会遇到什么新的问题吗？
当两个或两个以上的进程在执行过程中，因占有一些资源而又需要对方资源时，会因为争夺资源而造成一种互相等待的现象，若无外力作用，它们都将无法推进下去。这种现象称为死锁。

本节的知识架构图如下：

# 2.4 死锁
本节开头提出的问题的参考答案如下：
# 1. 为什么会产生死锁？产生死锁有什么条件？
由于系统中存在一些不可剥夺资源，而当两个或两个以上的进程占有自身资源，并请求对方资源时，会导致每个进程都无法向前推进，这就是死锁。死锁产生的必要条件有四个，分别是互斥条件、不剥夺条件、请求并保持条件和循环等待条件。
互斥条件是指进程要求分配的资源是排他性的，即最多只能同时给一个进程使用。

不剥夺条件是指进程在使用资源完毕之前，资源不能被强制夺走。

请求并保持条件是指进程占有自身本来拥有的资源并要求其他资源。

循环等待条件是指存在一种进程资源的循环等待链。

# 2. 有什么办法可以解决死锁问题?
死锁的处理策略可以分为预防死锁、避免死锁和死锁的检测及解除。

死锁的预防是通过设立一些限制条件，破坏死锁的一些必要条件，让死锁无法发生。

死锁的避免是在动态分配资源的过程中，用一些算法防止系统进入不安全状态，从而避免死锁。

死锁的检测和解除是在死锁产生前不采取任何措施，只检测当前系统有没有发生死锁，若有，则采取一些措施解除死锁。

本节的知识架构图如下：


# 2.5本章疑难点
## 1.进程与程序的区别与联系
1) 进程是程序及其数据在计算机上的一次运行活动，是一个动态的概念。进程的运行实体是程序，离开程序的进程没有存在的意义。从静态角度看，进程是由程序、数据和进程控制块(PCB)三部分组成的。而程序是一组有序的指令集合，是一种静态的概念。

2) 进程是程序的一次执行过程，它是动态地创建和消亡的，具有一定的生命周期，是暂时 存在的；而程序则是一组代码的集合，它是永久存在的，可长期保存。

3) 一个进程可以执行一个或几个程序，一个程序也可以构成多个进程。进程可创建进程，而程序不可能形成新的程序。

4) 进程与程序的组成不同。进程的组成包括程序、数据和PCB。

## 2.死锁与饥饿
具有等待队列的信号量的实现可能导致这样的情况：两个或多个进程无限地等待一个事件，而该事件只能由这些等待进程之一来产生。这里的事件是V操作的执行（即释放资源）。当出现这样的状态时，这些进程称为死锁（Deadlocked)。

为了加以说明，考虑到一个系统由两个进程PO和P1组成，每个进程都访问两个信号量S和Q，这两个信号量的初值均为1。

```java
P0(){				P1(){
	while⑴{			while (1){
		P(S);				P(Q);
		P(Q);				P(S);
		...					...
		V(S);				V(Q);
		Y(Q);				V(S);
	}					}
}					}
```

假设进程P0执行P(S)，接着进程P1执行P(Q)。当进程P0执行P(Q)时，它必须等待直到进程P1执行V(Q)。类似地，当进程P1执行P(S)，它必须等待直到进程P0执行V(S)。由于这两个V操作都不能执行，那么进程P0和进程P1就死锁了。

说一组进程处于死锁状态是指：组内的每个进程都等待一个事件，而该事件只可能由组内的 另一个进程产生。这里所关心的主要是事件是资源的获取和释放。

与死锁相关的另一个问题是无限期阻塞(Indefinite Blocking)或饥饿（Starvation),即进程 在信号量内无穷等待的情况。

产生饥饿的主要原因是：在一个动态系统中，对于每类系统资源，操作系统需要确定一个分 配策略，当多个进程同时申请某类资源时，由分配策略确定资源分配给进程的次序。有时资源分配策略可能是不公平的，即不能保证等待时间上界的存在。在这种情况下，即使系统没有发生死锁某些进程也可能会长时间等待。当等待时间给进程推进和响应带来明显影响时，称发生了进 程“饥饿”，当“饥饿”到一定程度的进程所赋予的任务即使完成也不再具有实际意义时称该进 程被“饿死”。

例如，当有多个进程需要打印文件时，如果系统分配打印机的策略是最短文件优先，那么长 文件的打印任务将由于短文件的源源不断到来而被无限期推迟，导致最终的“饥饿”甚至“饿死”。

“饥饿”并不表示系统一定死锁，但至少有一个进程的执行被无限期推迟。“饥饿”与死锁的主要差别有：

1)进入“饥饿”状态的进程可以只有一个，而由于循环等待条件而进入死锁状态的进程却必须大于或等于两个。

2)处于“饥饿”状态的进程可以是一个就绪进程，如静态优先权调度算法时的低优先权进程，而处于死锁状态的进程则必定是阻塞进程。

## 3. 银行家算法的工作原理
银行家算法的主要思想是避免系统进入不安全状态。在每次进行资源分配时，它首先检查系 统是否有足够的资源满足要求，如果有，则先进行分配，并对分配后的新状态进行安全性检查。 如果新状态安全，则正式分配上述资源，否则就拒绝分配上述资源。这样，它保证系统始终处于安全状态，从而避免死锁现象的发生。

## 4. 进程同步、互斥的区别和联系

并发进程的执行会产生相互制约的关系：一种是进程之间竞争使用临界资源，只能让它们逐 个使用，这种现象称为互斥，是一种竞争关系；另一种是进程之间协同完成任务，在关键点上等待另一个进程发来的消息，以便协同一致，是一种协作关系。

## 5. 作业和进程的关系

进程是系统资源的使用者，系统的资源大部分都是以进程为单位分配的。而用户使用计算机是为了实现一串相关的任务，通常把用户要求计算机完成的这一串任务称为作业。

(1)批处理系统中作业与进程的关系（进程组织）

批处理系统中的可以通过磁记录设备或卡片机向系统提交批作业，由系统的SPOOLing输入进程将作业放入磁盘的输入井中，作为后备作业。作业调度程序（一般也作为独立的进程运行—）每当选择一道后备作业运行时，首先为该作业创建一个进程（称为该作业的根进程)。该 执行作业控制语言解释程序解释该作业的作业说明书。父进程在运行过程中可以动态地创建一个或多个子进程，执行说明书中的语句。例如，对一条编译的语句，该进程可以创建一个子进程执行编译程序对用户源程序进行编译。类似地，子进程也可以继续创建子进程去完成指定的功能。因此，一个作业就动态地转换成了一组运行实体——进程族。当父进程遇到作业说明书中的“撤出作业”的语句时，将该作业从运行状态改变为完成状态，将作业及相关结果送入磁盘上的输出井。作业终止进程负责将输出井中的作业利用打印机输出，回收作业所占用的资源，删除作业有关数据结构，删除作业在磁盘输出井中的信息等等。作业终止进程撤除一道作业后，可向作业调度进程请求进行新的作业调度。至此，一道进入系统运行的作业全部结束。

(2)分时系统中作业与进程的关系

在分时系统中，作业的提交方法、组织形式均与批处理作业有很大差异。分时系统的用户通 过命令语言逐条地与系统应答式地输入命令，提交作业步。每输入一条（或一组）命令，便直接在系统内部对应一个（或若干个）进程。在系统启动时，系统为每个终端设备建立一个进程（称为终端进程），该进程执行命令解释程序，命令解释程序从终端设备读入命令，解释执行用户输入的每一条命令。对于每一条终端命令，可以创建一个子进程去具体执行。若当前的终端命令是一条后台命令，则可以和下一条终端命令并行处理。各子进程在运行过程中完全可以根据需要创建子孙进程。终端命令所对应的进程结束后，命令的功能也相应处理完毕。用户本次上机完毕，用户通过一条登出命令即结束上机过程。

分时系统的作业就是用户的一次上机交互过程，可以认为终端进程的创建是一个交互作业的 开始，登出命令运行结束代表用户交互作业的终止。

命令解释程序流程扮演着批处理系统中作业控制语言解释程序的角色，只不过命令解释程序 是从用户终端接收命令。

(3)交互地提交批作业

在同时支持交互和批处理的操作系统中，人们可以用交互的方式准备好批作业的有关程序、数据及作业控制说明书。比如，可用交互式系统提供的全屏幕编辑命令编辑好自编的一个天气预报程序，用编译及装配命令将程序变成可执行文件，用调试命令进行程序调试。在调试成功后，用户每天都要做如下工作：准备原始天气数据，运行天气预报执行文件处理原始数据，把结果打印出来等。这时，用交互系统提供的全屏幕编辑命令编辑好将要提交的作业控制说明书文件，如Windows系统的bat文件和Linux系统的sh文件。然后用一条作业提交命令将作业提交给系统作业队列中。系统有专门的作业调度进程负责从作业队列中选择作业，为被选取的作业创建一个父进程运行命令解释程序，解释执行作业控制说明书文件中的命令。